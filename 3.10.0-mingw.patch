--- origsrc/FreeImage/Makefile	2006-12-14 02:04:06.000000000 -0600
+++ src/FreeImage/Makefile	2013-12-31 18:57:01.125234300 -0600
@@ -10,6 +10,9 @@ endif
 ifeq ($(OS), Cygwin)
     MAKEFILE = cygwin
 endif
+ifeq ($(OS), MinGW)
+    MAKEFILE = mingw
+endif
 ifeq ($(OS), Solaris)
     MAKEFILE = solaris
 endif
--- origsrc/FreeImage/Makefile.fip	2013-12-31 18:31:31.489348100 -0600
+++ src/FreeImage/Makefile.fip	2013-12-31 19:16:46.697060600 -0600
@@ -15,17 +15,18 @@ INSTALLDIR = /usr/lib
 DOS2UNIX = dos2unix
 
 COMPILERFLAGS = -O3 -fexceptions -fvisibility=hidden
-LIBRARIES = -lstdc++ -L. -lfreeimage
+LIBRARIES = -lstdc++ -L. -lfreeimage.dll -lgdi32
 
 MODULES = $(SRCS:.c=.o)
 MODULES := $(MODULES:.cpp=.o)
+DLLMODULES = $(MODULES:.o=.lo)
 CFLAGS = $(COMPILERFLAGS) $(INCLUDE)
 CXXFLAGS = $(COMPILERFLAGS) -Wno-ctor-dtor-privacy $(INCLUDE)
 
 TARGET  = freeimageplus
 STATICLIB = lib$(TARGET).a
-SHAREDLIB = lib$(TARGET)-$(VER_MAJOR).$(VER_MINOR).so
-LIBNAME	= lib$(TARGET).so
+SHAREDLIB = $(TARGET).dll
+LIBNAME	= lib$(TARGET).dll.a
 VERLIBNAME = $(LIBNAME).$(VER_MAJOR)
 HEADER = Source/FreeImage.h
 HEADERFIP = Wrapper/FreeImagePlus/FreeImagePlus.h
@@ -37,7 +38,8 @@ all: dist
 
 dist: FreeImage
 	cp *.a Dist
-	cp *.so Dist
+	cp *.dll Dist
+	cp *.dll.a Dist
 	cp Source/FreeImage.h Dist
 	cp Wrapper/FreeImagePlus/FreeImagePlus.h Dist
 
@@ -47,16 +49,22 @@ dos2unix:
 FreeImage: $(STATICLIB) $(SHAREDLIB)
 
 .c.o:
-	$(CC) $(CFLAGS) -c $< -o $@
+	$(CC) $(CFLAGS) -DFREEIMAGE_LIB -c $< -o $@
+
+%.lo: %.c
+	$(CC) $(CFLAGS) -DFIP_EXPORTS -c $< -o $@
 
 .cpp.o:
-	$(CXX) $(CXXFLAGS) -c $< -o $@
+	$(CXX) $(CXXFLAGS) -DFREEIMAGE_LIB -c $< -o $@
+
+%.lo: %.cpp
+	$(CXX) $(CXXFLAGS) -DFIP_EXPORTS -c $< -o $@
 
 $(STATICLIB): $(MODULES)
 	$(AR) r $@ $(MODULES)
 
-$(SHAREDLIB): $(MODULES)
-	$(CC) -s -shared -Wl,-soname,$(VERLIBNAME) -o $@ $(MODULES) $(LIBRARIES)
+$(SHAREDLIB): $(DLLMODULES)
+	$(CC) -shared -Wl,--out-implib,$(LIBNAME) -o $@ $(DLLMODULES) $(LIBRARIES)
 
 install:
 	install -m 644 -o root -g root $(HEADER) $(INCDIR)
--- origsrc/FreeImage/Makefile.mingw	1969-12-31 18:00:00.000000000 -0600
+++ src/FreeImage/Makefile.mingw	2013-12-31 19:17:20.679004200 -0600
@@ -0,0 +1,78 @@
+# Cygwin makefile for FreeImage
+
+# This file can be generated by ./gensrclist.sh
+include Makefile.srcs
+
+# General configuration variables:
+CC = gcc
+CXX = g++
+AR = ar
+
+INSTALLDIR = /usr
+
+# Converts cr/lf to just lf
+DOS2UNIX = dos2unix
+
+COMPILERFLAGS = -O3
+LIBRARIES = -lstdc++
+
+MODULES = $(SRCS:.c=.o)
+MODULES := $(MODULES:.cpp=.o)
+DLLMODULES = $(MODULES:.o=.lo)
+CFLAGS = $(COMPILERFLAGS) -D_WINDOWS $(INCLUDE)
+CXXFLAGS = $(COMPILERFLAGS) -D_WINDOWS -Wno-ctor-dtor-privacy $(INCLUDE)
+
+TARGET  = freeimage
+STATICLIB = lib$(TARGET).a
+SHAREDLIB = $(TARGET).dll
+LIBNAME = lib$(TARGET).dll.a
+HEADER = Source/FreeImage.h
+
+
+default: all
+
+all: dist
+
+dist: FreeImage
+	cp *.a Dist
+	cp *.dll Dist
+	cp *.dll.a Dist
+	cp $(HEADER) Dist
+
+dos2unix:
+	@$(DOS2UNIX) $(SRCS) $(INCLS)
+
+FreeImage: $(STATICLIB) $(SHAREDLIB)
+
+.c.o:
+	$(CC) $(CFLAGS) -DFREEIMAGE_LIB -c $< -o $@
+
+%.lo: %.c
+	$(CC) $(CFLAGS) -DFREEIMAGE_EXPORTS -c $< -o $@
+
+.cpp.o:
+	$(CXX) $(CXXFLAGS) -DFREEIMAGE_LIB -c $< -o $@
+
+%.lo: %.cpp
+	$(CXX) $(CXXFLAGS) -DFREEIMAGE_EXPORTS -c $< -o $@
+
+$(STATICLIB): $(MODULES)
+	$(AR) r $@ $(MODULES)
+
+$(SHAREDLIB): $(DLLMODULES)
+	$(CC) -shared -o $@ \
+	    -Wl,--out-implib=$(LIBNAME) \
+	    -Wl,--enable-auto-import \
+	    -Wl,--enable-auto-image-base \
+	    $(DLLMODULES) $(LIBRARIES)
+
+
+install:
+	install -m 644 $(STATICLIB) $(INSTALLDIR)/lib
+	install -m 644 $(LIBNAME) $(INSTALLDIR)/lib
+	install -m 755 $(SHAREDLIB) $(INSTALLDIR)/bin
+	install -m 644 $(HEADER) $(INSTALLDIR)/include
+
+clean:
+	rm -f core Dist/*.* u2dtmp* $(MODULES) $(STATICLIB) $(SHAREDLIB) $(LIBNAME)
+
--- origsrc/FreeImage/Source/FreeImage/PluginBMP.cpp	2013-12-31 18:31:31.105326100 -0600
+++ src/FreeImage/Source/FreeImage/PluginBMP.cpp	2013-12-31 18:54:36.025890200 -0600
@@ -35,14 +35,12 @@ static const BYTE RLE_ENDOFLINE   = 0;
 static const BYTE RLE_ENDOFBITMAP = 1;
 static const BYTE RLE_DELTA       = 2;
 
-#ifndef __MINGW32__		// prevents a bug in mingw32
 
 static const BYTE BI_RGB          = 0;
 static const BYTE BI_RLE8         = 1;
 static const BYTE BI_RLE4         = 2;
 static const BYTE BI_BITFIELDS    = 3;
 
-#endif // __MINGW32__
 
 // ----------------------------------------------------------
 
@@ -52,7 +50,6 @@ static const BYTE BI_BITFIELDS    = 3;
 #pragma pack(1)
 #endif
 
-#ifndef __MINGW32__
 typedef struct tagBITMAPCOREHEADER {
   DWORD   bcSize;
   WORD    bcWidth;
@@ -60,7 +57,6 @@ typedef struct tagBITMAPCOREHEADER {
   WORD    bcPlanes;
   WORD    bcBitCnt;
 } BITMAPCOREHEADER, *PBITMAPCOREHEADER; 
-#endif //__MINGW32__
 
 typedef struct tagBITMAPINFOOS2_1X_HEADER {
   DWORD  biSize;
@@ -70,7 +66,6 @@ typedef struct tagBITMAPINFOOS2_1X_HEADE
   WORD   biBitCount;
 } BITMAPINFOOS2_1X_HEADER, *PBITMAPINFOOS2_1X_HEADER; 
 
-#ifndef __MINGW32__
 typedef struct tagBITMAPFILEHEADER {
   WORD    bfType; 
   DWORD   bfSize;
@@ -78,7 +73,6 @@ typedef struct tagBITMAPFILEHEADER {
   WORD    bfReserved2;
   DWORD   bfOffBits; 
 } BITMAPFILEHEADER, *PBITMAPFILEHEADER;
-#endif //__MINGW32__
 
 #ifdef _WIN32
 #pragma pack(pop)
